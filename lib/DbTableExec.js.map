{"version":3,"sources":["../src/DbTableExec.js"],"names":["dayjs","require","chalk","module","exports","DbTableExec","constructor","table","DbMysql","connection","def","modelname","selected","command","returnCompleteRow","primary","primaryType","primaryLength","where","whereData","onlyOne","order","having","groupby","tabAlreadyIncluded","logQuery","catchErr","iscount","joinModels","fieldJoin","modelnameto","modelalias","fieldName","field","Object","entries","attributes","type","length","select","fields","find","undefined","count","findone","create","data","cloneDeep","what","JSON","parse","stringify","update","original_where","original_whereData","replace","updateone","query","querySaved","destroy","_searchModelFromFieldName","fromModelName","f","n","isNotAlias","models","model","alias","modeltolink","modeltolinkname","log","debug","swallowError","catchError","returnRow","populateAll","exclude","me","populateThis","origins","defField","indexOf","populate","tabFieldsJoins","split","previousModelName","previousModelAlias","tabOrigin","iJoin","join","console","warn","red","magenta","push","modelaliasto","origin","fieldJoinName","orderBy","groupBy","_createWhere","fromUpdate","Number","isInteger","forEach","num","reg","RegExp","concat","index","key","val","_createSelect","tabSelect","as","_createJoin","tabJoin","tableName","_createOrder","_createSelectQuery","_createInsertQuery","vals","autoincrement","hasOwnProperty","defaultsTo","_createUpdateQuery","_createDestroyQuery","_preTreatment","e","Date","format","m","isValid","_postTreatment","rows","row","obj","previousObj","lastO","o","_beforeQuery","fn","fn2","useUpdatedAt","updatedAt","updatedAtForced","beforeUpdate","beforeDestroy","useCreatedAt","createdAt","createdAtForced","beforeCreate","beforeSelect","exec","w","wData","yellowBright","cyan","error","postTreatmentMain","res","affectedRows","insertId","cmpt","rows2","ftemp"],"mappings":"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","sourcesContent":["const dayjs = require(\"dayjs\");\nconst chalk = require(\"chalk\");\nmodule.exports = class DbTableExec {\n\tconstructor(table) {\n\t\tthis.table = table;\n\t\tthis.DbMysql = table.DbMysql;\n\t\tthis.connection = table.connection;\n\t\tthis.def = table.def;\n\t\tthis.modelname = this.def.modelname;\n\t\tthis.selected = [];\n\t\tthis.command = \"SELECT\";\n\t\tthis.returnCompleteRow = true;\n\t\tthis.primary = \"id\";\n\t\tthis.primaryType = \"integer\";\n\t\tthis.primaryLength = 11;\n\t\tthis.where = \"\";\n\t\tthis.whereData = [];\n\t\tthis.onlyOne = false;\n\t\tthis.order = \"\";\n\t\tthis.having = \"\";\n\t\tthis.groupby = \"\";\n\t\tthis.tabAlreadyIncluded = {};\n\t\tthis.logQuery = false;\n\t\tthis.catchErr = false;\n\t\tthis.iscount = false;\n\t\t// this.swallowerror = false;\n\t\tthis.joinModels = [{ modelname: this.modelname, fieldJoin: null, modelnameto: null, modelalias: \"t1\" }];\n\t\tfor (const [fieldName, field] of Object.entries(this.def.attributes)) {\n\t\t\tif (field.primary) {\n\t\t\t\tthis.primary = fieldName;\n\t\t\t\tthis.primaryType = field.type;\n\t\t\t\tthis.primaryLength = field.length;\n\t\t\t}\n\t\t}\n\t}\n\tselect(fields) {\n\t\tthis.selected = fields;\n\t\treturn this;\n\t}\n\tfind(where, whereData) {\n\t\tthis.command = \"SELECT\";\n\t\tthis.onlyOne = false;\n\t\tthis.where = where;\n\t\tif (whereData === undefined) this.whereData = [];\n\t\telse this.whereData = whereData;\n\t\treturn this;\n\t}\n\tcount(where, whereData) {\n\t\tthis.iscount = true;\n\t\treturn this.find(where, whereData);\n\t}\n\tfindone(where, whereData) {\n\t\tthis.onlyOne = true;\n\t\tthis.where = where;\n\t\tif (whereData === undefined) this.whereData = [];\n\t\telse this.whereData = whereData;\n\t\treturn this;\n\t}\n\tcreate(data) {\n\t\tthis.onlyOne = false;\n\t\tthis.command = \"INSERT\";\n\t\tthis.data = data;\n\t\treturn this;\n\t}\n\tcloneDeep(what) {\n\t\treturn JSON.parse(JSON.stringify(what));\n\t}\n\tupdate(where, whereData, data) {\n\t\tif (data === undefined) {\n\t\t\tdata = whereData;\n\t\t\tthis.whereData = [];\n\t\t} else {\n\t\t\tthis.whereData = whereData;\n\t\t}\n\t\tthis.original_where = this.cloneDeep(where);\n\t\tthis.original_whereData = this.cloneDeep(this.whereData);\n\t\tthis.whereData = [];\n\n\t\tthis.onlyOne = false;\n\t\tthis.command = \"UPDATE\";\n\t\tthis.where = where;\n\t\tthis.data = data;\n\t\treturn this;\n\t}\n\treplace(data) {\n\t\tthis.whereData = [];\n\n\t\tthis.onlyOne = false;\n\t\tthis.command = \"REPLACE\";\n\t\tthis.where = \"\";\n\t\tthis.data = data;\n\t\treturn this;\n\t}\n\tupdateone(where, whereData, data) {\n\t\tthis.update(where, whereData, data);\n\t\tthis.onlyOne = true;\n\t\treturn this;\n\t}\n\tquery(query, data) {\n\t\tthis.command = \"QUERY\";\n\t\tthis.whereData = data;\n\t\tthis.querySaved = query;\n\t\treturn this;\n\t}\n\tdestroy(where, whereData = []) {\n\t\tthis.whereData = whereData;\n\t\tthis.onlyOne = false;\n\t\tthis.command = \"DELETE\";\n\t\tthis.where = where;\n\t\treturn this;\n\t}\n\t_searchModelFromFieldName(fieldJoin, fromModelName) {\n\t\tlet f = null,\n\t\t\tn = \"\",\n\t\t\tisNotAlias = false;\n\t\tfor (const [fieldName, field] of Object.entries(this.DbMysql.models[fromModelName].def.attributes)) {\n\t\t\tif (field.model && (field.alias == fieldJoin || fieldName == fieldJoin)) {\n\t\t\t\tf = field;\n\t\t\t\tn = fieldName;\n\t\t\t\tif (fieldName == fieldJoin) isNotAlias = true;\n\t\t\t}\n\t\t}\n\t\treturn { modeltolink: f, modeltolinkname: n, isNotAlias };\n\t}\n\tlog() {\n\t\tthis.logQuery = true;\n\t\treturn this;\n\t}\n\tdebug() {\n\t\tthis.logQuery = true;\n\t\treturn this;\n\t}\n\tswallowError() {\n\t\tthis.catchErr = false;\n\t\treturn this;\n\t}\n\tcatchError() {\n\t\tthis.catchErr = true;\n\t\treturn this;\n\t}\n\treturnRow(returnCompleteRow) {\n\t\tthis.returnCompleteRow = returnCompleteRow;\n\t\treturn this;\n\t}\n\tpopulateAll(exclude = []) {\n\t\tlet me = this;\n\t\tfunction populateThis(table, origins) {\n\t\t\t// eslint-disable-next-line\n\t\t\tfor (const [field, defField] of Object.entries(table.def.attributes)) {\n\t\t\t\tif (defField.model) {\n\t\t\t\t\tif (exclude.indexOf(origins + defField.alias) >= 0) continue;\n\t\t\t\t\tme.populate(origins + defField.alias);\n\t\t\t\t\tpopulateThis(me.DbMysql.models[defField.model], origins + defField.alias + \".\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tpopulateThis(this.table, \"\");\n\t\t//origins=[]\n\t\treturn this;\n\t}\n\tpopulate(fieldJoin) {\n\t\tlet tabFieldsJoins = fieldJoin.split(\".\");\n\t\tlet previousModelName = this.modelname;\n\t\tlet previousModelAlias = \"t1\";\n\t\tlet tabOrigin = [];\n\t\tfor (let iJoin = 0; iJoin < tabFieldsJoins.length; iJoin++) {\n\t\t\tlet join = tabFieldsJoins[iJoin];\n\n\t\t\tlet { modeltolink, modeltolinkname, isNotAlias } = this._searchModelFromFieldName(join, previousModelName);\n\t\t\tif (!modeltolink) {\n\t\t\t\tconsole.warn(chalk.red(`The alias ${join} not found in table ${previousModelName}. Can't populate ${fieldJoin}.`));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!modeltolink.alias) {\n\t\t\t\tconsole.warn(chalk.red(`Alias name is mandatory for field ${modeltolinkname}`));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (isNotAlias) {\n\t\t\t\tconsole.warn(chalk.magenta(`It's better to indicate alias name '${modeltolink.alias}' rather field name ${join} to populate`));\n\t\t\t\tjoin = modeltolink.alias;\n\t\t\t}\n\t\t\tlet modelalias = \"t1\";\n\t\t\ttabOrigin.push(join);\n\t\t\tif (!this.tabAlreadyIncluded[modeltolink.model + \"__\" + tabOrigin.join(\"_\")]) {\n\t\t\t\tmodelalias = tabOrigin.join(\"__\"); //+ modeltolink.alias\n\t\t\t\tthis.joinModels.push({\n\t\t\t\t\tmodelname: modeltolink.model,\n\t\t\t\t\tmodelalias: modelalias,\n\t\t\t\t\tfieldJoin: modeltolinkname,\n\t\t\t\t\tmodelnameto: previousModelName,\n\t\t\t\t\tmodelaliasto: previousModelAlias,\n\t\t\t\t\torigin: tabOrigin.join(\".\"),\n\t\t\t\t\tfieldJoinName: modeltolink.alias || null,\n\t\t\t\t});\n\t\t\t\tthis.tabAlreadyIncluded[modeltolink.model + \"__\" + tabOrigin.join(\"_\")] = modelalias;\n\t\t\t} else {\n\t\t\t\tmodelalias = this.tabAlreadyIncluded[modeltolink.model + \"__\" + tabOrigin.join(\"_\")];\n\t\t\t}\n\t\t\tpreviousModelName = modeltolink.model;\n\t\t\tpreviousModelAlias = modelalias;\n\t\t}\n\t\treturn this;\n\t}\n\torderBy(order) {\n\t\tthis.order = order;\n\t\treturn this;\n\t}\n\tgroupBy(groupby) {\n\t\tthis.groupby = groupby;\n\t\treturn this;\n\t}\n\thaving(having) {\n\t\tthis.having = having;\n\t\treturn this;\n\t}\n\t_createWhere(fromUpdate) {\n\t\tlet where = \"\";\n\t\tif (!this.where) {\n\t\t\twhere = \"1=1\";\n\t\t} else if (Number.isInteger(this.where)) {\n\t\t\twhere += this.primary + \"=?\";\n\t\t\tthis.whereData.push(this.where);\n\t\t} else if (typeof this.where === \"string\") {\n\t\t\twhere = this.where;\n\t\t\tthis.joinModels.forEach((model, num) => {\n\t\t\t\tif (model.origin) {\n\t\t\t\t\tlet reg = new RegExp(model.origin, \"gi\");\n\t\t\t\t\twhere = where.replace(reg, model.modelalias);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (fromUpdate) {\n\t\t\t\tthis.whereData = this.whereData.concat(this.original_whereData);\n\t\t\t}\n\t\t} else {\n\t\t\twhere += \"1\";\n\t\t\tObject.entries(this.where).forEach(([key, val], index) => {\n\t\t\t\twhere += \" && \" + key + \"=?\";\n\t\t\t\tthis.whereData.push(val);\n\t\t\t});\n\t\t}\n\n\t\treturn where;\n\t}\n\t_createSelect() {\n\t\tlet tabSelect = [];\n\t\tthis.joinModels.forEach((model, num) => {\n\t\t\tfor (const [fieldName] of Object.entries(this.DbMysql.models[model.modelname].def.attributes)) {\n\t\t\t\tlet as = \"\";\n\t\t\t\tif (model.modelnameto) as = \" AS \" + model.modelalias + \"_\" + model.fieldJoin + \"_\" + fieldName;\n\t\t\t\ttabSelect.push(model.modelalias + \".\" + fieldName + as);\n\t\t\t}\n\t\t});\n\t\tif (this.selected.length) tabSelect = this.selected;\n\t\treturn tabSelect.join(\", \");\n\t}\n\t_createJoin() {\n\t\tlet tabJoin = [];\n\t\tthis.joinModels.forEach((model, num) => {\n\t\t\tif (!model.modelnameto) tabJoin.push(this.DbMysql.models[model.modelname].def.tableName + \" \" + model.modelalias);\n\t\t\telse\n\t\t\t\ttabJoin.push(\n\t\t\t\t\t\"LEFT JOIN \" +\n\t\t\t\t\t\tthis.DbMysql.models[model.modelname].def.tableName +\n\t\t\t\t\t\t\" \" +\n\t\t\t\t\t\tmodel.modelalias +\n\t\t\t\t\t\t\" ON \" +\n\t\t\t\t\t\tmodel.modelalias +\n\t\t\t\t\t\t\".\" +\n\t\t\t\t\t\tthis.DbMysql.models[model.modelname].primary +\n\t\t\t\t\t\t\"=\" +\n\t\t\t\t\t\tmodel.modelaliasto +\n\t\t\t\t\t\t\".\" +\n\t\t\t\t\t\tmodel.fieldJoin\n\t\t\t\t);\n\t\t});\n\t\treturn tabJoin.join(\" \");\n\t}\n\t_createOrder() {\n\t\tlet order = \"\";\n\t\tif (this.order) order = \" ORDER BY \" + this.order;\n\t\treturn order;\n\t}\n\t_createSelectQuery() {\n\t\tlet query = \"SELECT \" + this._createSelect() + \" FROM \" + this._createJoin() + \" WHERE \" + this._createWhere() + this._createOrder();\n\t\tif (this.iscount) {\n\t\t\tquery =\n\t\t\t\t\"SELECT count(t1.\" + this.primary + \") as cmpt FROM \" + this._createJoin() + \" WHERE \" + this._createWhere() + this._createOrder();\n\t\t}\n\t\treturn query;\n\t}\n\t_createInsertQuery() {\n\t\tlet fields = [],\n\t\t\tvals = [];\n\t\tfor (const [key, val] of Object.entries(this.def.attributes)) {\n\t\t\tif (val.primary && val.autoincrement) continue;\n\t\t\tfields.push(key);\n\t\t\tvals.push(\"?\");\n\t\t\tif (this.data.hasOwnProperty(key)) {\n\t\t\t\tthis.whereData.push(this.data[key]);\n\t\t\t} else {\n\t\t\t\tif (val.defaultsTo) this.whereData.push(val.defaultsTo);\n\t\t\t\telse {\n\t\t\t\t\tif (\n\t\t\t\t\t\tval.type == \"int\" ||\n\t\t\t\t\t\tval.type == \"integer\" ||\n\t\t\t\t\t\tval.type == \"tinyint\" ||\n\t\t\t\t\t\tval.type == \"smallint\" ||\n\t\t\t\t\t\tval.type == \"mediumint\" ||\n\t\t\t\t\t\tval.type == \"year\" ||\n\t\t\t\t\t\tval.type == \"float\" ||\n\t\t\t\t\t\tval.type == \"double\" ||\n\t\t\t\t\t\tval.type == \"boolean\"\n\t\t\t\t\t)\n\t\t\t\t\t\tthis.whereData.push(0);\n\t\t\t\t\telse this.whereData.push(\"\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tlet query = \"INSERT INTO \" + this.def.tableName + \"(\" + fields.join(\", \") + \") VALUES (\" + vals.join(\", \") + \")\";\n\t\treturn query;\n\t}\n\t_createUpdateQuery() {\n\t\tlet vals = [];\n\t\tfor (const [key, val] of Object.entries(this.data)) {\n\t\t\tif (this.def.attributes[key]) {\n\t\t\t\tvals.push(key + \"=?\");\n\t\t\t\tthis.whereData.push(val);\n\t\t\t}\n\t\t}\n\t\tlet query = \"UPDATE \" + this.def.tableName + \" SET \" + vals.join(\", \") + \" WHERE \" + this._createWhere(true);\n\t\treturn query;\n\t}\n\t// _createReplaceQuery() {\n\t// \tlet vals = [];\n\t// \tfor (const [key, val] of Object.entries(this.data)) {\n\t// \t\tif (this.def.attributes[key]) {\n\t// \t\t\tvals.push(key + \"=?\");\n\t// \t\t\tthis.whereData.push(val);\n\t// \t\t}\n\t// \t}\n\t// \tlet query = \"UPDATE \" + this.def.tableName + \" SET \" + vals.join(\", \") + \" WHERE \" + this._createWhere(true);\n\t// \treturn query;\n\t// }\n\t_createDestroyQuery() {\n\t\tlet query = \"DELETE FROM \" + this.def.tableName + \" WHERE \" + this._createWhere();\n\t\treturn query;\n\t}\n\t_preTreatment() {\n\t\tfor (const [fieldName, field] of Object.entries(this.def.attributes)) {\n\t\t\tif (!fieldName || this.data[fieldName] === undefined) continue;\n\t\t\tif (field.type == \"json\" && typeof this.data[fieldName] == \"object\") {\n\t\t\t\ttry {\n\t\t\t\t\tthis.data[fieldName] = JSON.stringify(this.data[fieldName]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn(\"json stringify error\", e);\n\t\t\t\t\tthis.data[fieldName] = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (field.type == \"json\" && typeof this.data[fieldName] !== \"object\") {\n\t\t\t\ttry {\n\t\t\t\t\tthis.data[fieldName] = JSON.parse(this.data[fieldName]);\n\t\t\t\t} catch (e) {}\n\t\t\t\ttry {\n\t\t\t\t\tthis.data[fieldName] = JSON.stringify(this.data[fieldName]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.warn(\"json stringify error\", e);\n\t\t\t\t\tthis.data[fieldName] = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (field.type == \"boolean\") {\n\t\t\t\tif (this.data[fieldName] === false) this.data[fieldName] = 0;\n\t\t\t\tif (this.data[fieldName] === true) this.data[fieldName] = 1;\n\t\t\t\tif (this.data[fieldName] === \"false\") this.data[fieldName] = 0;\n\t\t\t\tif (this.data[fieldName] === \"true\") this.data[fieldName] = 1;\n\t\t\t}\n\t\t\tif (field.type == \"datetime\" && this.data[fieldName]) {\n\t\t\t\tthis.data[fieldName] = dayjs(new Date(this.data[fieldName])).format(\"YYYY-MM-DD HH:mm:ss\");\n\t\t\t}\n\t\t\tif (field.type == \"date\" && this.data[fieldName]) {\n\t\t\t\tlet m = dayjs(new Date(this.data[fieldName]));\n\t\t\t\tif (this.data[fieldName] == \"0000-00-00\" || this.data[fieldName] == \"\" || !m.isValid()) this.data[fieldName] = \"0000-00-00\";\n\t\t\t\telse this.data[fieldName] = m.format(\"YYYY-MM-DD\");\n\t\t\t}\n\t\t\tif (field.type == \"datetime\" && this.data[fieldName]) {\n\t\t\t\tlet m = dayjs(new Date(this.data[fieldName]));\n\t\t\t\tif (\n\t\t\t\t\tthis.data[fieldName] == \"0000-00-00\" ||\n\t\t\t\t\tthis.data[fieldName] == \"0000-00-00 00:00:00\" ||\n\t\t\t\t\tthis.data[fieldName] == \"\" ||\n\t\t\t\t\t!m.isValid()\n\t\t\t\t)\n\t\t\t\t\tthis.data[fieldName] = \"0000-00-00 00:00:00\";\n\t\t\t\telse this.data[fieldName] = m.format(\"YYYY-MM-DD HH:mm:ss\");\n\t\t\t}\n\t\t}\n\t}\n\t_postTreatment(rows) {\n\t\trows.forEach((row) => {\n\t\t\tfor (const [fieldName, field] of Object.entries(this.def.attributes)) {\n\t\t\t\tif (field.type == \"json\") {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tif (row[fieldName]) row[fieldName] = JSON.parse(row[fieldName]);\n\t\t\t\t\t\telse row[fieldName] = null;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.warn(chalk.red(`json parse error - fieldName:\"${fieldName}\" - value:\"${row[fieldName]}\"`));\n\t\t\t\t\t\trow[fieldName] = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (field.type == \"boolean\") {\n\t\t\t\t\tif (row[fieldName] === true || row[fieldName] === \"true\" || row[fieldName] === 1 || row[fieldName] === \"1\") row[fieldName] = true;\n\t\t\t\t\telse row[fieldName] = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.joinModels.forEach((model, num) => {\n\t\t\t\tif (model.modelnameto) {\n\t\t\t\t\tlet obj = {};\n\n\t\t\t\t\tfor (const [fieldName, field] of Object.entries(this.DbMysql.models[model.modelname].def.attributes)) {\n\t\t\t\t\t\t// let f = DbMysql.models[model.modelname].def.tableName+'_'+model.fieldJoin+'_'+fieldName ;\n\t\t\t\t\t\tlet f = model.modelalias + \"_\" + model.fieldJoin + \"_\" + fieldName;\n\t\t\t\t\t\tif (row.hasOwnProperty(f)) {\n\t\t\t\t\t\t\tif (field.type == \"json\") {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tif (row[f]) row[f] = JSON.parse(row[f]);\n\t\t\t\t\t\t\t\t\telse row[f] = null;\n\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\tconsole.warn(chalk.red(\"json parse error\"), e, f, row[f]);\n\t\t\t\t\t\t\t\t\trow[f] = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tobj[fieldName] = row[f];\n\t\t\t\t\t\t\tdelete row[f];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (model.fieldJoinName && model.modelaliasto == \"t1\") {\n\t\t\t\t\t\trow[model.fieldJoinName] = obj;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (!obj[this.DbMysql.models[model.modelname].primary]) {\n\t\t\t\t\t\t\tobj = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlet tabFieldsJoins = model.origin.split(\".\");\n\t\t\t\t\t\tlet previousObj = row;\n\t\t\t\t\t\tlet lastO = null;\n\t\t\t\t\t\ttabFieldsJoins.forEach((o, index) => {\n\t\t\t\t\t\t\tlastO = o;\n\t\t\t\t\t\t\tif (index >= tabFieldsJoins.length - 1) return;\n\t\t\t\t\t\t\tpreviousObj = previousObj[o];\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (previousObj) previousObj[lastO] = obj;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\tasync _beforeQuery() {\n\t\tlet fn = null,\n\t\t\tfn2 = null;\n\t\tswitch (this.command) {\n\t\t\tcase \"UPDATE\":\n\t\t\t\t// if (this.def.useUpdatedAt && !this.data.updatedAt) this.data.updatedAt = new Date();\n\t\t\t\tif (this.def.useUpdatedAt) this.data.updatedAt = new Date();\n\t\t\t\tif (this.data.updatedAtForced) this.data.updatedAt = this.data.updatedAtForced;\n\t\t\t\tif (this.def.beforeUpdate) fn = this.def.beforeUpdate;\n\t\t\t\tbreak;\n\t\t\tcase \"DELETE\":\n\t\t\t\tif (this.def.beforeDestroy) fn2 = this.def.beforeDestroy;\n\t\t\t\tbreak;\n\t\t\tcase \"INSERT\":\n\t\t\t\t// if (this.def.useCreatedAt && !this.data.createdAt) this.data.createdAt = new Date();\n\t\t\t\t// if (this.def.useUpdatedAt && !this.data.updatedAt) this.data.updatedAt = new Date();\n\t\t\t\tif (this.def.useCreatedAt) this.data.createdAt = new Date();\n\t\t\t\tif (this.def.useUpdatedAt) this.data.updatedAt = new Date();\n\t\t\t\tif (this.data.createdAtForced) this.data.createdAt = this.data.createdAtForced;\n\t\t\t\tif (this.data.updatedAtForced) this.data.updatedAt = this.data.updatedAtForced;\n\t\t\t\tif (this.def.beforeCreate) fn = this.def.beforeCreate;\n\t\t\t\tbreak;\n\t\t\t// case 'REPLACE':\n\t\t\t// if (this.def.beforeCreate) fn = this.def.beforeCreate ;\n\t\t\t// break;\n\t\t\tdefault:\n\t\t\t\tif (this.def.beforeSelect) fn = this.def.beforeSelect;\n\t\t}\n\t\tif (fn) await fn(this.data);\n\t\telse if (fn2) await fn();\n\t}\n\tasync exec(returnCompleteRow = true) {\n\t\tif (this.command == \"REPLACE\") {\n\t\t\tlet w = \"0\",\n\t\t\t\twData = [];\n\t\t\tif (this.data[this.primary]) {\n\t\t\t\tw = this.primary + \"=?\";\n\t\t\t\twData.push(this.data[this.primary]);\n\t\t\t}\n\t\t\tlet query = \"SELECT \" + this.primary + \" FROM \" + this.def.tableName + \" WHERE \" + w;\n\t\t\trows = await this.connection.query(query, wData, this.catchErr);\n\t\t\tif (rows.length) {\n\t\t\t\tthis.command = \"UPDATE\";\n\t\t\t\tthis.where = this.primary + \"=?\";\n\t\t\t\tthis.whereData = [];\n\t\t\t\tthis.original_where = this.primary + \"=?\";\n\t\t\t\tthis.original_whereData = [rows[0][this.primary]];\n\t\t\t} else {\n\t\t\t\tthis.command = \"INSERT\";\n\t\t\t\tdelete this.data[this.primary];\n\t\t\t}\n\t\t}\n\n\t\tthis._beforeQuery();\n\t\tlet query;\n\t\tswitch (this.command) {\n\t\t\tcase \"QUERY\":\n\t\t\t\tquery = this.querySaved;\n\t\t\t\tbreak;\n\t\t\tcase \"INSERT\":\n\t\t\t\tthis._preTreatment();\n\t\t\t\tquery = this._createInsertQuery();\n\t\t\t\tbreak;\n\t\t\tcase \"UPDATE\":\n\t\t\t\tthis._preTreatment();\n\t\t\t\tquery = this._createUpdateQuery();\n\t\t\t\tbreak;\n\t\t\tcase \"DELETE\":\n\t\t\t\tquery = this._createDestroyQuery();\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tquery = this._createSelectQuery();\n\t\t}\n\n\t\tif (this.def.debug || this.logQuery) console.warn(\"query\", chalk.yellowBright(query), chalk.cyan(this.whereData));\n\t\tlet rows;\n\t\ttry {\n\t\t\trows = await this.connection.query(query, this.whereData, this.catchErr);\n\t\t} catch (error) {\n\t\t\tthrow error;\n\t\t}\n\t\tlet data = await this.postTreatmentMain(rows, returnCompleteRow);\n\t\treturn data;\n\t\t// }\n\t}\n\tasync postTreatmentMain(rows, returnCompleteRow) {\n\t\tlet res;\n\t\tif (!rows) {\n\t\t\tres = {};\n\t\t\tswitch (this.command) {\n\t\t\t\tcase \"QUERY\":\n\t\t\t\t\tres = [];\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"UPDATE\":\n\t\t\t\t\tres = null;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"DELETE\":\n\t\t\t\t\tres = 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"INSERT\":\n\t\t\t\t\tres = null;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tres = {};\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn res;\n\t\t}\n\t\tswitch (this.command) {\n\t\t\tcase \"QUERY\":\n\t\t\t\tres = rows;\n\t\t\t\tbreak;\n\t\t\tcase \"UPDATE\":\n\t\t\t\tres = rows.affectedRows;\n\t\t\t\tbreak;\n\t\t\tcase \"DELETE\":\n\t\t\t\tres = rows.affectedRows;\n\t\t\t\tbreak;\n\t\t\tcase \"INSERT\":\n\t\t\t\tres = rows.insertId;\n\t\t\t\tif (res) this.data[this.primary] = rows.insertId;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (this.iscount) res = rows[0].cmpt;\n\t\t\t\telse {\n\t\t\t\t\tthis._postTreatment(rows);\n\t\t\t\t\tif (this.onlyOne) {\n\t\t\t\t\t\tif (rows.length) res = rows[0];\n\t\t\t\t\t\telse res = null;\n\t\t\t\t\t} else res = rows;\n\t\t\t\t}\n\t\t}\n\t\tif (this.def.debug) console.warn(\"res\", res);\n\t\tif (returnCompleteRow && (this.command == \"UPDATE\" || this.command == \"INSERT\")) {\n\t\t\tif (this.command == \"UPDATE\") {\n\t\t\t\tlet rows2 = await this.table.find(this.original_where, this.original_whereData).exec();\n\t\t\t\tif (this.onlyOne) return rows2[0];\n\t\t\t\treturn rows2;\n\t\t\t} else {\n\t\t\t\tlet ftemp = {};\n\t\t\t\tftemp[this.primary] = res;\n\t\t\t\tif (!res) {\n\t\t\t\t\tftemp[this.primary] = this.data[this.primary];\n\t\t\t\t}\n\t\t\t\tlet rows2 = await this.table.findone(ftemp).exec();\n\t\t\t\treturn rows2;\n\t\t\t}\n\t\t} else return res;\n\t}\n};\n"],"file":"DbTableExec.js"}