{"version":3,"sources":["../src/main.js"],"names":["rootDir","process","cwd","MorphineJs","constructor","initDb","DbMysql","init","Config","mysql","executeMigration","Migration","update","initExpress","initMiddlewares","initResSendData","App","use","req","res","next","Services","ErrorCodes","sendData","errorKeyOrData","status","data","err","getErrorCode","send","notFound","start","server","http","createServer","Promise","accept","reject","listen","app","port","console","warn","host","mode"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AAGA;;AACA;;AAEA;;AACA;;AACA;;AACA;;AAEA;;;;;;;;AACA;AAEA,IAAMA,OAAO,GAAGC,OAAO,CAACC,GAAR,EAAhB;;AAEA,IAAMC,UAAU,GAAG,MAAM;AACxBC,EAAAA,WAAW,GAAG,CAAE;;AAEVC,EAAAA,MAAM,GAAG;AAAA;AACd,YAAMC,iBAAQC,IAAR,CAAaC,eAAOC,KAApB,CAAN;AADc;AAEd;;AACKC,EAAAA,gBAAgB,GAAG;AAAA;AACxBC,yBAAUC,MAAV;AADwB;AAExB;;AACKC,EAAAA,WAAW,GAAG;AAAA;AAAE;;AAChBC,EAAAA,eAAe,GAAG;AAAA;AAAE;;AAC1BC,EAAAA,eAAe,GAAG;AACjBC,aAAIC,GAAJ,CAAQ,UAAUC,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AACjC,UAAI,CAACC,mBAASC,UAAd,EAA0B,OAAOF,IAAI,EAAX;;AAC1BD,MAAAA,GAAG,CAACI,QAAJ,GAAe,UAAUC,cAAV,EAAwC;AAAA,YAAdC,MAAc,uEAAL,GAAK;AACtD;AACA,YAAIC,IAAJ;AACAF,QAAAA,cAAc,GAAGA,cAAc,IAAI,EAAnC;;AACA,YAAIA,cAAc,IAAI,OAAOA,cAAP,KAA0B,QAAhD,EAA0D;AACzDE,UAAAA,IAAI,GAAG;AAAEC,YAAAA,GAAG,EAAEN,mBAASC,UAAT,CAAoBM,YAApB,CAAiCJ,cAAjC;AAAP,WAAP;AACAC,UAAAA,MAAM,GAAGC,IAAI,CAACC,GAAL,CAASF,MAAlB;AACA,SAHD,MAGO;AACNC,UAAAA,IAAI,GAAGF,cAAP;AACAE,UAAAA,IAAI,CAACC,GAAL,GAAW,IAAX;AACA;;AACDR,QAAAA,GAAG,CAACM,MAAJ,CAAWA,MAAX,EAAmBI,IAAnB,CAAwBH,IAAxB;AACA,OAZD;;AAaAN,MAAAA,IAAI;AACJ,KAhBD;AAiBA;;AACKU,EAAAA,QAAQ,GAAG;AAAA;AAAE;;AAEbC,EAAAA,KAAK,GAAG;AAAA;;AAAA;AACb,YAAM,KAAI,CAAC1B,MAAL,EAAN;AACA,YAAM,KAAI,CAACK,gBAAL,EAAN;AACA,YAAM,6BAAN;AACA,YAAM,KAAI,CAACG,WAAL,EAAN;AACA,YAAM,KAAI,CAACC,eAAL,EAAN;;AACA,MAAA,KAAI,CAACC,eAAL;;AACA,YAAM,mCAAN;AACA,YAAM,kCAAN;AACA,YAAM,KAAI,CAACe,QAAL,EAAN;;AAEA,UAAIE,MAAM,GAAGC,cAAKC,YAAL,CAAkBlB,QAAlB,CAAb;;AACA,YAAM,IAAImB,OAAJ,CAAY,CAACC,MAAD,EAASC,MAAT,KAAoB;AACrCL,QAAAA,MAAM,CAACM,MAAP,CAAc9B,eAAO+B,GAAP,CAAWC,IAAzB,EAA+B,MAAM;AACpCJ,UAAAA,MAAM;AACN,SAFD;AAGA,OAJK,CAAN;AAKAK,MAAAA,OAAO,CAACC,IAAR,wBAA6BlC,eAAO+B,GAAP,CAAWI,IAAxC,kBAAoDnC,eAAO+B,GAAP,CAAWK,IAA/D;AAjBa;AAkBb;;AAlDuB,CAAzB","sourcesContent":["import http from \"http\";\n// import path from \"path\";\n\nimport { App } from \"./App\";\nimport { Services, Service, loadServices } from \"./Services\";\n// console.log(\"Services\", Services);\nimport { Config } from \"./Config\";\nimport { Controller, loadControllers } from \"./Controller\";\nimport { Get, Post, Put, Delete, Crud } from \"./MethodDecorators\";\nimport { Middlewares, Middleware, loadMiddlewares } from \"./Middlewares\";\n\nimport { DbMysql, Model, Models, Migration } from \"./DbMysql\";\n// const Models = DbMysql.models;\n\nconst rootDir = process.cwd();\n\nconst MorphineJs = class {\n\tconstructor() {}\n\n\tasync initDb() {\n\t\tawait DbMysql.init(Config.mysql);\n\t}\n\tasync executeMigration() {\n\t\tMigration.update();\n\t}\n\tasync initExpress() {}\n\tasync initMiddlewares() {}\n\tinitResSendData() {\n\t\tApp.use(function (req, res, next) {\n\t\t\tif (!Services.ErrorCodes) return next();\n\t\t\tres.sendData = function (errorKeyOrData, status = 200) {\n\t\t\t\t// console.log(\"this\", this);\n\t\t\t\tlet data;\n\t\t\t\terrorKeyOrData = errorKeyOrData || {};\n\t\t\t\tif (errorKeyOrData && typeof errorKeyOrData === \"string\") {\n\t\t\t\t\tdata = { err: Services.ErrorCodes.getErrorCode(errorKeyOrData) };\n\t\t\t\t\tstatus = data.err.status;\n\t\t\t\t} else {\n\t\t\t\t\tdata = errorKeyOrData;\n\t\t\t\t\tdata.err = null;\n\t\t\t\t}\n\t\t\t\tres.status(status).send(data);\n\t\t\t};\n\t\t\tnext();\n\t\t});\n\t}\n\tasync notFound() {}\n\n\tasync start() {\n\t\tawait this.initDb();\n\t\tawait this.executeMigration();\n\t\tawait loadServices();\n\t\tawait this.initExpress();\n\t\tawait this.initMiddlewares();\n\t\tthis.initResSendData();\n\t\tawait loadMiddlewares();\n\t\tawait loadControllers();\n\t\tawait this.notFound();\n\n\t\tlet server = http.createServer(App);\n\t\tawait new Promise((accept, reject) => {\n\t\t\tserver.listen(Config.app.port, () => {\n\t\t\t\taccept();\n\t\t\t});\n\t\t});\n\t\tconsole.warn(`Listening on ${Config.app.host} ! - ${Config.app.mode}`);\n\t}\n};\n\nexport {\n\trootDir,\n\tMorphineJs,\n\tConfig,\n\tApp,\n\tController,\n\tCrud,\n\tGet,\n\tPost,\n\tPut,\n\tDelete,\n\tDbMysql,\n\tModels,\n\tModel,\n\tServices,\n\tService,\n\tMiddleware,\n\tMiddlewares,\n\tMigration,\n};\n"],"file":"main.js"}